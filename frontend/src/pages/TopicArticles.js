import React, { useState, useEffect } from 'react';
import { useParams, Link, useNavigate, useLocation } from 'react-router-dom';
import { Settings, User } from 'lucide-react';
import './TopicArticles.css';
import { progressAPI } from '../services/api';

const TopicArticles = () => {
  const { topic } = useParams();
  const navigate = useNavigate();
  const location = useLocation();
  const [hoveredLesson, setHoveredLesson] = useState(null);

  // Определяем заголовок темы
  const topicTitle = topic === 'rent' ? 'Съем квартиры' : 'Работа';
  const topicSlug = topic || 'job';

  // Генерируем список уроков (11 уроков для примера)
  const lessons = Array.from({ length: 11 }, (_, i) => i + 1);

  // Прогресс из БД
  const [lessonStatusByNumber, setLessonStatusByNumber] = useState({});

  useEffect(() => {
    const loadProgress = async () => {
      try {
        const res = await progressAPI.getByTopic(topicSlug);
        const map = {};
        for (const i of (res.data?.items || [])) { map[i.lesson_number] = i.status; }
        
        // Если первый урок не найден в БД, делаем его активным
        if (!map[1]) {
          try {
            await progressAPI.markActive(topicSlug, 1);
            map[1] = 'active';
          } catch (error) {
            console.warn('Не удалось инициализировать первый урок:', error);
          }
        }
        
        setLessonStatusByNumber(map);
      } catch (error) {
        // Ошибка загрузки прогресса - оставляем пустым
        console.warn('Не удалось загрузить прогресс уроков:', error);
        // Все равно делаем первый урок активным
        setLessonStatusByNumber({ 1: 'active' });
      }
    };

    loadProgress();
  }, [topicSlug, location.pathname]);

  // Ротация цветов: [#F8A720, #C97200, #C97200, #642714]
  const palette = ['#F8A720', '#C97200', '#642714'];
  const getLessonColor = (lessonNumber) => palette[(lessonNumber - 1) % 3];

  // Проверяем, существует ли урок
  const lessonExists = (lessonNumber) => {
    if (topic === 'rent') {
      const existingLessons = [1, 2, 3]; // Список существующих уроков
      return existingLessons.includes(lessonNumber);
    }
    return false;
  };

  // Получаем название урока
  const getLessonTitle = (lessonNumber) => {
    if (topic === 'rent' && lessonNumber === 1) {
      return 'Поиск жилища';
    }
    if (topic === 'rent' && lessonNumber === 2) {
      return 'Вопрос – копейку бережет';
    }
    if (topic === 'rent' && lessonNumber === 3) {
      return 'Документы – базовый минимум';
    }
    return `Урок ${lessonNumber}`;
  };

  // Позиции для шестиугольников в honeycomb pattern согласно дизайну
  const getLessonPosition = (lessonNumber) => {
    const positions = {
      1: { left: '823px', top: '447px' },   // Polygon 143
      2: { left: '707px', top: '649px' },   // Polygon 150
      3: { left: '474px', top: '649px' },   // Polygon 142
      4: { left: '357px', top: '852px' },   // Polygon 157
      5: { left: '474px', top: '1054px' },  // Polygon 158
      6: { left: '707px', top: '1054px' },  // Polygon 166
      7: { left: '823px', top: '1257px' },  // Polygon 175
      8: { left: '707px', top: '1459px' },  // Polygon 182
      9: { left: '474px', top: '1459px' },  // Polygon 174
      10: { left: '474px', top: '1864px' }, // Polygon 190
      11: { left: '823px', top: '1662px' }, // Polygon 189
    };
    return positions[lessonNumber] || { left: '0px', top: '0px' };
  };

  const handleLessonClick = async (lessonNumber) => {
    // Проверяем, существует ли урок
    if (!lessonExists(lessonNumber)) {
      return; // Не переходим к несуществующему уроку
    }

    // Первый урок всегда доступен
    if (lessonNumber === 1) {
      navigate(`/topic/${topicSlug}/lesson/${lessonNumber}`);
      return;
    }
    
    // Для остальных уроков проверяем статус
    const status = lessonStatusByNumber[lessonNumber];
    
    // Если урок имеет статус 'active' или 'completed', он доступен
    if (status === 'active' || status === 'completed') {
      navigate(`/topic/${topicSlug}/lesson/${lessonNumber}`);
      return;
    }
    
    // Проверяем, что предыдущий урок пройден
    const previousStatus = lessonStatusByNumber[lessonNumber - 1];
    if (previousStatus === 'completed') {
      // Предыдущий урок пройден, но текущий еще не активен - попробуем обновить прогресс
      try {
        await progressAPI.markActive(topicSlug, lessonNumber);
        // Обновляем локальный статус
        setLessonStatusByNumber(prev => ({
          ...prev,
          [lessonNumber]: 'active'
        }));
        navigate(`/topic/${topicSlug}/lesson/${lessonNumber}`);
      } catch (error) {
        console.error('Ошибка активации урока:', error);
        // Все равно пытаемся перейти
        navigate(`/topic/${topicSlug}/lesson/${lessonNumber}`);
      }
      return;
    }
    
    // Если статуса нет или он 'locked', и предыдущий не пройден - урок заблокирован
    if (!status || status === 'locked') {
      return;
    }
    
    // В остальных случаях разрешаем переход (на случай если данные не синхронизированы)
    navigate(`/topic/${topicSlug}/lesson/${lessonNumber}`);
  };

  return (
    <div className="topic-articles-page">
      <div className="topic-articles-container">
        {/* Заголовок */}
        <div className="topic-articles-header">
          <div className="topic-articles-header-content">
            <div className="header-logo">ЛОГОТИП</div>
            <nav className="header-nav">
              <Link to="/dashboard" className="header-nav-link">Задания</Link>
              <Link to="/shop" className="header-nav-link">Магазин</Link>
            </nav>
            <div className="header-social-links">
              <Link to="/settings" className="header-social-icon">
                <Settings size={32} color="#000000" />
              </Link>
              <Link to="/profile" className="header-social-icon">
                <User size={32} color="#000000" />
              </Link>
            </div>
          </div>
        </div>

        {/* Основной контент */}
        <div className="topic-articles-content">
          <div className="topic-articles-background">
            {/* Декоративный SVG с белыми пентагонами */}
            <div className="decorative-pentagons">
              <svg 
                width="1920" 
                height="2400" 
                viewBox="0 0 1920 2400" 
                fill="none" 
                xmlns="http://www.w3.org/2000/svg"
                className="decorative-svg"
              >
                <g clipPath="url(#clip0_36_9)">
                  <rect width="1920" height="2400" fill="white"/>
                  <rect x="260" width="1400" height="2400" fill="#FFEBCA"/>
                  
                  <mask id="mask0_36_9" style={{maskType: 'alpha'}} maskUnits="userSpaceOnUse" x="172" y="-145" width="1615" height="2666">
                    <path d="M266 461.66C275.282 456.301 286.718 456.301 296 461.66L374.253 506.84C383.535 512.199 389.253 522.103 389.253 532.821V623.179C389.253 633.897 383.535 643.801 374.253 649.16L296 694.34C286.718 699.699 275.282 699.699 266 694.34L187.747 649.16C178.465 643.801 172.747 633.897 172.747 623.179V532.821C172.747 522.103 178.465 512.199 187.747 506.84L266 461.66Z" fill="black"/>
                    <path d="M266 866.66C275.282 861.301 286.718 861.301 296 866.66L374.253 911.84C383.535 917.199 389.253 927.103 389.253 937.821V1028.18C389.253 1038.9 383.535 1048.8 374.253 1054.16L296 1099.34C286.718 1104.7 275.282 1104.7 266 1099.34L187.747 1054.16C178.465 1048.8 172.747 1038.9 172.747 1028.18V937.821C172.747 927.103 178.465 917.199 187.747 911.84L266 866.66Z" fill="black"/>
                    <path d="M266 1271.66C275.282 1266.3 286.718 1266.3 296 1271.66L374.253 1316.84C383.535 1322.2 389.253 1332.1 389.253 1342.82V1433.18C389.253 1443.9 383.535 1453.8 374.253 1459.16L296 1504.34C286.718 1509.7 275.282 1509.7 266 1504.34L187.747 1459.16C178.465 1453.8 172.747 1443.9 172.747 1433.18V1342.82C172.747 1332.1 178.465 1322.2 187.747 1316.84L266 1271.66Z" fill="black"/>
                    <path d="M383 663.66C392.282 658.301 403.718 658.301 413 663.66L491.253 708.84C500.535 714.199 506.253 724.103 506.253 734.821V825.179C506.253 835.897 500.535 845.801 491.253 851.16L413 896.34C403.718 901.699 392.282 901.699 383 896.34L304.747 851.16C295.465 845.801 289.747 835.897 289.747 825.179V734.821C289.747 724.103 295.465 714.199 304.747 708.84L383 663.66Z" fill="black"/>
                    <path d="M732 461.66C741.282 456.301 752.718 456.301 762 461.66L840.253 506.84C849.535 512.199 855.253 522.103 855.253 532.821V623.179C855.253 633.897 849.535 643.801 840.253 649.16L762 694.34C752.718 699.699 741.282 699.699 732 694.34L653.747 649.16C644.465 643.801 638.747 633.897 638.747 623.179V532.821C638.747 522.103 644.465 512.199 653.747 506.84L732 461.66Z" fill="black"/>
                    <path d="M732 1271.66C741.282 1266.3 752.718 1266.3 762 1271.66L840.253 1316.84C849.535 1322.2 855.253 1332.1 855.253 1342.82V1433.18C855.253 1443.9 849.535 1453.8 840.253 1459.16L762 1504.34C752.718 1509.7 741.282 1509.7 732 1504.34L653.747 1459.16C644.465 1453.8 638.747 1443.9 638.747 1433.18V1342.82C638.747 1332.1 644.465 1322.2 653.747 1316.84L732 1271.66Z" fill="black"/>
                    <path d="M1198 866.66C1207.28 861.301 1218.72 861.301 1228 866.66L1306.25 911.84C1315.54 917.199 1321.25 927.103 1321.25 937.821V1028.18C1321.25 1038.9 1315.54 1048.8 1306.25 1054.16L1228 1099.34C1218.72 1104.7 1207.28 1104.7 1198 1099.34L1119.75 1054.16C1110.46 1048.8 1104.75 1038.9 1104.75 1028.18V937.821C1104.75 927.103 1110.46 917.199 1119.75 911.84L1198 866.66Z" fill="black"/>
                    <path d="M1198 1676.66C1207.28 1671.3 1218.72 1671.3 1228 1676.66L1306.25 1721.84C1315.54 1727.2 1321.25 1737.1 1321.25 1747.82V1838.18C1321.25 1848.9 1315.54 1858.8 1306.25 1864.16L1228 1909.34C1218.72 1914.7 1207.28 1914.7 1198 1909.34L1119.75 1864.16C1110.46 1858.8 1104.75 1848.9 1104.75 1838.18V1747.82C1104.75 1737.1 1110.46 1727.2 1119.75 1721.84L1198 1676.66Z" fill="black"/>
                    <path d="M1315 258.66C1324.28 253.301 1335.72 253.301 1345 258.66L1423.25 303.84C1432.54 309.199 1438.25 319.103 1438.25 329.821V420.179C1438.25 430.897 1432.54 440.801 1423.25 446.16L1345 491.34C1335.72 496.699 1324.28 496.699 1315 491.34L1236.75 446.16C1227.46 440.801 1221.75 430.897 1221.75 420.179V329.821C1221.75 319.103 1227.46 309.199 1236.75 303.84L1315 258.66Z" fill="black"/>
                    <path d="M1315 663.66C1324.28 658.301 1335.72 658.301 1345 663.66L1423.25 708.84C1432.54 714.199 1438.25 724.103 1438.25 734.821V825.179C1438.25 835.897 1432.54 845.801 1423.25 851.16L1345 896.34C1335.72 901.699 1324.28 901.699 1315 896.34L1236.75 851.16C1227.46 845.801 1221.75 835.897 1221.75 825.179V734.821C1221.75 724.103 1227.46 714.199 1236.75 708.84L1315 663.66Z" fill="black"/>
                    <path d="M1315 1068.66C1324.28 1063.3 1335.72 1063.3 1345 1068.66L1423.25 1113.84C1432.54 1119.2 1438.25 1129.1 1438.25 1139.82V1230.18C1438.25 1240.9 1432.54 1250.8 1423.25 1256.16L1345 1301.34C1335.72 1306.7 1324.28 1306.7 1315 1301.34L1236.75 1256.16C1227.46 1250.8 1221.75 1240.9 1221.75 1230.18V1139.82C1221.75 1129.1 1227.46 1119.2 1236.75 1113.84L1315 1068.66Z" fill="black"/>
                    <path d="M1315 1473.66C1324.28 1468.3 1335.72 1468.3 1345 1473.66L1423.25 1518.84C1432.54 1524.2 1438.25 1534.1 1438.25 1544.82V1635.18C1438.25 1645.9 1432.54 1655.8 1423.25 1661.16L1345 1706.34C1335.72 1711.7 1324.28 1711.7 1315 1706.34L1236.75 1661.16C1227.46 1655.8 1221.75 1645.9 1221.75 1635.18V1544.82C1221.75 1534.1 1227.46 1524.2 1236.75 1518.84L1315 1473.66Z" fill="black"/>
                    <path d="M1663 56.6603C1672.28 51.3013 1683.72 51.3013 1693 56.6603L1771.25 101.84C1780.54 107.199 1786.25 117.103 1786.25 127.821V218.179C1786.25 228.897 1780.54 238.801 1771.25 244.16L1693 289.34C1683.72 294.699 1672.28 294.699 1663 289.34L1584.75 244.16C1575.46 238.801 1569.75 228.897 1569.75 218.179V127.821C1569.75 117.103 1575.46 107.199 1584.75 101.84L1663 56.6603Z" fill="black"/>
                    <path d="M1663 1271.66C1672.28 1266.3 1683.72 1266.3 1693 1271.66L1771.25 1316.84C1780.54 1322.2 1786.25 1332.1 1786.25 1342.82V1433.18C1786.25 1443.9 1780.54 1453.8 1771.25 1459.16L1693 1504.34C1683.72 1509.7 1672.28 1509.7 1663 1504.34L1584.75 1459.16C1575.46 1453.8 1569.75 1443.9 1569.75 1433.18V1342.82C1569.75 1332.1 1575.46 1322.2 1584.75 1316.84L1663 1271.66Z" fill="black"/>
                    <path d="M499 866.66C508.282 861.301 519.718 861.301 529 866.66L607.253 911.84C616.535 917.199 622.253 927.103 622.253 937.821V1028.18C622.253 1038.9 616.535 1048.8 607.253 1054.16L529 1099.34C519.718 1104.7 508.282 1104.7 499 1099.34L420.747 1054.16C411.465 1048.8 405.747 1038.9 405.747 1028.18V937.821C405.747 927.103 411.465 917.199 420.747 911.84L499 866.66Z" fill="black"/>
                    <path d="M499 1676.66C508.282 1671.3 519.718 1671.3 529 1676.66L607.253 1721.84C616.535 1727.2 622.253 1737.1 622.253 1747.82V1838.18C622.253 1848.9 616.535 1858.8 607.253 1864.16L529 1909.34C519.718 1914.7 508.282 1914.7 499 1909.34L420.747 1864.16C411.465 1858.8 405.747 1848.9 405.747 1838.18V1747.82C405.747 1737.1 411.465 1727.2 420.747 1721.84L499 1676.66Z" fill="black"/>
                    <path d="M616 663.66C625.282 658.301 636.718 658.301 646 663.66L724.253 708.84C733.535 714.199 739.253 724.103 739.253 734.821V825.179C739.253 835.897 733.535 845.801 724.253 851.16L646 896.34C636.718 901.699 625.282 901.699 616 896.34L537.747 851.16C528.465 845.801 522.747 835.897 522.747 825.179V734.821C522.747 724.103 528.465 714.199 537.747 708.84L616 663.66Z" fill="black"/>
                    <path d="M616 1068.66C625.282 1063.3 636.718 1063.3 646 1068.66L724.253 1113.84C733.535 1119.2 739.253 1129.1 739.253 1139.82V1230.18C739.253 1240.9 733.535 1250.8 724.253 1256.16L646 1301.34C636.718 1306.7 625.282 1306.7 616 1301.34L537.747 1256.16C528.465 1250.8 522.747 1240.9 522.747 1230.18V1139.82C522.747 1129.1 528.465 1119.2 537.747 1113.84L616 1068.66Z" fill="black"/>
                    <path d="M616 1473.66C625.282 1468.3 636.718 1468.3 646 1473.66L724.253 1518.84C733.535 1524.2 739.253 1534.1 739.253 1544.82V1635.18C739.253 1645.9 733.535 1655.8 724.253 1661.16L646 1706.34C636.718 1711.7 625.282 1711.7 616 1706.34L537.747 1661.16C528.465 1655.8 522.747 1645.9 522.747 1635.18V1544.82C522.747 1534.1 528.465 1524.2 537.747 1518.84L616 1473.66Z" fill="black"/>
                    <path d="M616 1878.66C625.282 1873.3 636.718 1873.3 646 1878.66L724.253 1923.84C733.535 1929.2 739.253 1939.1 739.253 1949.82V2040.18C739.253 2050.9 733.535 2060.8 724.253 2066.16L646 2111.34C636.718 2116.7 625.282 2116.7 616 2111.34L537.747 2066.16C528.465 2060.8 522.747 2050.9 522.747 2040.18V1949.82C522.747 1939.1 528.465 1929.2 537.747 1923.84L616 1878.66Z" fill="black"/>
                    <path d="M965 56.6603C974.282 51.3013 985.718 51.3013 995 56.6603L1073.25 101.84C1082.54 107.199 1088.25 117.103 1088.25 127.821V218.179C1088.25 228.897 1082.54 238.801 1073.25 244.16L995 289.34C985.718 294.699 974.282 294.699 965 289.34L886.747 244.16C877.465 238.801 871.747 228.897 871.747 218.179V127.821C871.747 117.103 877.465 107.199 886.747 101.84L965 56.6603Z" fill="black"/>
                    <path d="M965 461.66C974.282 456.301 985.718 456.301 995 461.66L1073.25 506.84C1082.54 512.199 1088.25 522.103 1088.25 532.821V623.179C1088.25 633.897 1082.54 643.801 1073.25 649.16L995 694.34C985.718 699.699 974.282 699.699 965 694.34L886.747 649.16C877.465 643.801 871.747 633.897 871.747 623.179V532.821C871.747 522.103 877.465 512.199 886.747 506.84L965 461.66Z" fill="black"/>
                    <path d="M849 2283.66C858.282 2278.3 869.718 2278.3 879 2283.66L957.253 2328.84C966.535 2334.2 972.253 2344.1 972.253 2354.82V2445.18C972.253 2455.9 966.535 2465.8 957.253 2471.16L879 2516.34C869.718 2521.7 858.282 2521.7 849 2516.34L770.747 2471.16C761.465 2465.8 755.747 2455.9 755.747 2445.18V2354.82C755.747 2344.1 761.465 2334.2 770.747 2328.84L849 2283.66Z" fill="black"/>
                    <path d="M1314 2283.66C1323.28 2278.3 1334.72 2278.3 1344 2283.66L1422.25 2328.84C1431.54 2334.2 1437.25 2344.1 1437.25 2354.82V2445.18C1437.25 2455.9 1431.54 2465.8 1422.25 2471.16L1344 2516.34C1334.72 2521.7 1323.28 2521.7 1314 2516.34L1235.75 2471.16C1226.46 2465.8 1220.75 2455.9 1220.75 2445.18V2354.82C1220.75 2344.1 1226.46 2334.2 1235.75 2328.84L1314 2283.66Z" fill="black"/>
                    <path d="M1199 2081.66C1208.28 2076.3 1219.72 2076.3 1229 2081.66L1307.25 2126.84C1316.54 2132.2 1322.25 2142.1 1322.25 2152.82V2243.18C1322.25 2253.9 1316.54 2263.8 1307.25 2269.16L1229 2314.34C1219.72 2319.7 1208.28 2319.7 1199 2314.34L1120.75 2269.16C1111.46 2263.8 1105.75 2253.9 1105.75 2243.18V2152.82C1105.75 2142.1 1111.46 2132.2 1120.75 2126.84L1199 2081.66Z" fill="black"/>
                    <path d="M965 866.66C974.282 861.301 985.718 861.301 995 866.66L1073.25 911.84C1082.54 917.199 1088.25 927.103 1088.25 937.821V1028.18C1088.25 1038.9 1082.54 1048.8 1073.25 1054.16L995 1099.34C985.718 1104.7 974.282 1104.7 965 1099.34L886.747 1054.16C877.465 1048.8 871.747 1038.9 871.747 1028.18V937.821C871.747 927.103 877.465 917.199 886.747 911.84L965 866.66Z" fill="black"/>
                    <path d="M965 1271.66C974.282 1266.3 985.718 1266.3 995 1271.66L1073.25 1316.84C1082.54 1322.2 1088.25 1332.1 1088.25 1342.82V1433.18C1088.25 1443.9 1082.54 1453.8 1073.25 1459.16L995 1504.34C985.718 1509.7 974.282 1509.7 965 1504.34L886.747 1459.16C877.465 1453.8 871.747 1443.9 871.747 1433.18V1342.82C871.747 1332.1 877.465 1322.2 886.747 1316.84L965 1271.66Z" fill="black"/>
                    <path d="M965 1676.66C974.282 1671.3 985.718 1671.3 995 1676.66L1073.25 1721.84C1082.54 1727.2 1088.25 1737.1 1088.25 1747.82V1838.18C1088.25 1848.9 1082.54 1858.8 1073.25 1864.16L995 1909.34C985.718 1914.7 974.282 1914.7 965 1909.34L886.747 1864.16C877.465 1858.8 871.747 1848.9 871.747 1838.18V1747.82C871.747 1737.1 877.465 1727.2 886.747 1721.84L965 1676.66Z" fill="black"/>
                    <path d="M1082 258.66C1091.28 253.301 1102.72 253.301 1112 258.66L1190.25 303.84C1199.54 309.199 1205.25 319.103 1205.25 329.821V420.179C1205.25 430.897 1199.54 440.801 1190.25 446.16L1112 491.34C1102.72 496.699 1091.28 496.699 1082 491.34L1003.75 446.16C994.465 440.801 988.747 430.897 988.747 420.179V329.821C988.747 319.103 994.465 309.199 1003.75 303.84L1082 258.66Z" fill="black"/>
                    <path d="M1082 1878.66C1091.28 1873.3 1102.72 1873.3 1112 1878.66L1190.25 1923.84C1199.54 1929.2 1205.25 1939.1 1205.25 1949.82V2040.18C1205.25 2050.9 1199.54 2060.8 1190.25 2066.16L1112 2111.34C1102.72 2116.7 1091.28 2116.7 1082 2111.34L1003.75 2066.16C994.465 2060.8 988.747 2050.9 988.747 2040.18V1949.82C988.747 1939.1 994.465 1929.2 1003.75 1923.84L1082 1878.66Z" fill="black"/>
                    <path d="M1431 56.6603C1440.28 51.3013 1451.72 51.3013 1461 56.6603L1539.25 101.84C1548.54 107.199 1554.25 117.103 1554.25 127.821V218.179C1554.25 228.897 1548.54 238.801 1539.25 244.16L1461 289.34C1451.72 294.699 1440.28 294.699 1431 289.34L1352.75 244.16C1343.46 238.801 1337.75 228.897 1337.75 218.179V127.821C1337.75 117.103 1343.46 107.199 1352.75 101.84L1431 56.6603Z" fill="black"/>
                    <path d="M1431 461.66C1440.28 456.301 1451.72 456.301 1461 461.66L1539.25 506.84C1548.54 512.199 1554.25 522.103 1554.25 532.821V623.179C1554.25 633.897 1548.54 643.801 1539.25 649.16L1461 694.34C1451.72 699.699 1440.28 699.699 1431 694.34L1352.75 649.16C1343.46 643.801 1337.75 633.897 1337.75 623.179V532.821C1337.75 522.103 1343.46 512.199 1352.75 506.84L1431 461.66Z" fill="black"/>
                    <path d="M1431 1271.66C1440.28 1266.3 1451.72 1266.3 1461 1271.66L1539.25 1316.84C1548.54 1322.2 1554.25 1332.1 1554.25 1342.82V1433.18C1554.25 1443.9 1548.54 1453.8 1539.25 1459.16L1461 1504.34C1451.72 1509.7 1440.28 1509.7 1431 1504.34L1352.75 1459.16C1343.46 1453.8 1337.75 1443.9 1337.75 1433.18V1342.82C1337.75 1332.1 1343.46 1322.2 1352.75 1316.84L1431 1271.66Z" fill="black"/>
                    <path d="M1548 258.66C1557.28 253.301 1568.72 253.301 1578 258.66L1656.25 303.84C1665.54 309.199 1671.25 319.103 1671.25 329.821V420.179C1671.25 430.897 1665.54 440.801 1656.25 446.16L1578 491.34C1568.72 496.699 1557.28 496.699 1548 491.34L1469.75 446.16C1460.46 440.801 1454.75 430.897 1454.75 420.179V329.821C1454.75 319.103 1460.46 309.199 1469.75 303.84L1548 258.66Z" fill="black"/>
                    <path d="M1548 663.66C1557.28 658.301 1568.72 658.301 1578 663.66L1656.25 708.84C1665.54 714.199 1671.25 724.103 1671.25 734.821V825.179C1671.25 835.897 1665.54 845.801 1656.25 851.16L1578 896.34C1568.72 901.699 1557.28 901.699 1548 896.34L1469.75 851.16C1460.46 845.801 1454.75 835.897 1454.75 825.179V734.821C1454.75 724.103 1460.46 714.199 1469.75 708.84L1548 663.66Z" fill="black"/>
                    <path d="M1548 1068.66C1557.28 1063.3 1568.72 1063.3 1578 1068.66L1656.25 1113.84C1665.54 1119.2 1671.25 1129.1 1671.25 1139.82V1230.18C1671.25 1240.9 1665.54 1250.8 1656.25 1256.16L1578 1301.34C1568.72 1306.7 1557.28 1306.7 1548 1301.34L1469.75 1256.16C1460.46 1250.8 1454.75 1240.9 1454.75 1230.18V1139.82C1454.75 1129.1 1460.46 1119.2 1469.75 1113.84L1548 1068.66Z" fill="black"/>
                    <path d="M1548 1473.66C1557.28 1468.3 1568.72 1468.3 1578 1473.66L1656.25 1518.84C1665.54 1524.2 1671.25 1534.1 1671.25 1544.82V1635.18C1671.25 1645.9 1665.54 1655.8 1656.25 1661.16L1578 1706.34C1568.72 1711.7 1557.28 1711.7 1548 1706.34L1469.75 1661.16C1460.46 1655.8 1454.75 1645.9 1454.75 1635.18V1544.82C1454.75 1534.1 1460.46 1524.2 1469.75 1518.84L1548 1473.66Z" fill="black"/>
                    <path d="M266 2081.66C275.282 2076.3 286.718 2076.3 296 2081.66L374.253 2126.84C383.535 2132.2 389.253 2142.1 389.253 2152.82V2243.18C389.253 2253.9 383.535 2263.8 374.253 2269.16L296 2314.34C286.718 2319.7 275.282 2319.7 266 2314.34L187.747 2269.16C178.465 2263.8 172.747 2253.9 172.747 2243.18V2152.82C172.747 2142.1 178.465 2132.2 187.747 2126.84L266 2081.66Z" fill="black"/>
                    <path d="M732 2081.66C741.282 2076.3 752.718 2076.3 762 2081.66L840.253 2126.84C849.535 2132.2 855.253 2142.1 855.253 2152.82V2243.18C855.253 2253.9 849.535 2263.8 840.253 2269.16L762 2314.34C752.718 2319.7 741.282 2319.7 732 2314.34L653.747 2269.16C644.465 2263.8 638.747 2253.9 638.747 2243.18V2152.82C638.747 2142.1 644.465 2132.2 653.747 2126.84L732 2081.66Z" fill="black"/>
                    <path d="M1663 2081.66C1672.28 2076.3 1683.72 2076.3 1693 2081.66L1771.25 2126.84C1780.54 2132.2 1786.25 2142.1 1786.25 2152.82V2243.18C1786.25 2253.9 1780.54 2263.8 1771.25 2269.16L1693 2314.34C1683.72 2319.7 1672.28 2319.7 1663 2314.34L1584.75 2269.16C1575.46 2263.8 1569.75 2253.9 1569.75 2243.18V2152.82C1569.75 2142.1 1575.46 2132.2 1584.75 2126.84L1663 2081.66Z" fill="black"/>
                    <path d="M499 2081.66C508.282 2076.3 519.718 2076.3 529 2081.66L607.253 2126.84C616.535 2132.2 622.253 2142.1 622.253 2152.82V2243.18C622.253 2253.9 616.535 2263.8 607.253 2269.16L529 2314.34C519.718 2319.7 508.282 2319.7 499 2314.34L420.747 2269.16C411.465 2263.8 405.747 2253.9 405.747 2243.18V2152.82C405.747 2142.1 411.465 2132.2 420.747 2126.84L499 2081.66Z" fill="black"/>
                    <path d="M965 2081.66C974.282 2076.3 985.718 2076.3 995 2081.66L1073.25 2126.84C1082.54 2132.2 1088.25 2142.1 1088.25 2152.82V2243.18C1088.25 2253.9 1082.54 2263.8 1073.25 2269.16L995 2314.34C985.718 2319.7 974.282 2319.7 965 2314.34L886.747 2269.16C877.465 2263.8 871.747 2253.9 871.747 2243.18V2152.82C871.747 2142.1 877.465 2132.2 886.747 2126.84L965 2081.66Z" fill="black"/>
                    <path d="M1548 2283.66C1557.28 2278.3 1568.72 2278.3 1578 2283.66L1656.25 2328.84C1665.54 2334.2 1671.25 2344.1 1671.25 2354.82V2445.18C1671.25 2455.9 1665.54 2465.8 1656.25 2471.16L1578 2516.34C1568.72 2521.7 1557.28 2521.7 1548 2516.34L1469.75 2471.16C1460.46 2465.8 1454.75 2455.9 1454.75 2445.18V2354.82C1454.75 2344.1 1460.46 2334.2 1469.75 2328.84L1548 2283.66Z" fill="black"/>
                    <path d="M1547 -140.34C1556.28 -145.699 1567.72 -145.699 1577 -140.34L1655.25 -95.1603C1664.54 -89.8013 1670.25 -79.8975 1670.25 -69.1795V21.1795C1670.25 31.8975 1664.54 41.8013 1655.25 47.1602L1577 92.3397C1567.72 97.6987 1556.28 97.6987 1547 92.3398L1468.75 47.1603C1459.46 41.8013 1453.75 31.8975 1453.75 21.1795V-69.1795C1453.75 -79.8975 1459.46 -89.8013 1468.75 -95.1603L1547 -140.34Z" fill="black"/>
                    <path d="M850 -140.34C859.282 -145.699 870.718 -145.699 880 -140.34L958.253 -95.1603C967.535 -89.8013 973.253 -79.8975 973.253 -69.1795V21.1795C973.253 31.8975 967.535 41.8013 958.253 47.1602L880 92.3397C870.718 97.6987 859.282 97.6987 850 92.3398L771.747 47.1603C762.465 41.8013 756.747 31.8975 756.747 21.1795V-69.1795C756.747 -79.8975 762.465 -89.8013 771.747 -95.1603L850 -140.34Z" fill="black"/>
                    <path d="M1081 -140.34C1090.28 -145.699 1101.72 -145.699 1111 -140.34L1189.25 -95.1603C1198.54 -89.8013 1204.25 -79.8975 1204.25 -69.1795V21.1795C1204.25 31.8975 1198.54 41.8013 1189.25 47.1602L1111 92.3397C1101.72 97.6987 1090.28 97.6987 1081 92.3398L1002.75 47.1603C993.465 41.8013 987.747 31.8975 987.747 21.1795V-69.1795C987.747 -79.8975 993.465 -89.8013 1002.75 -95.1603L1081 -140.34Z" fill="black"/>
                  </mask>
                  
                  <g mask="url(#mask0_36_9)">
                    <rect x="260" y="-5" width="1400" height="3348" fill="white"/>
                  </g>
                </g>
                
                <defs>
                  <clipPath id="clip0_36_9">
                    <rect width="1920" height="2400" fill="white"/>
                  </clipPath>
                </defs>
              </svg>
            </div>

            {/* Заголовок темы */}
            <h1 className="topic-title">{topicTitle}</h1>

            {/* Сетка уроков */}
            <div className="lessons-grid">
              {lessons.map((lessonNumber) => {
                const position = getLessonPosition(lessonNumber);
                const color = getLessonColor(lessonNumber);
                // Первый урок всегда активен по умолчанию
                const defaultStatus = lessonNumber === 1 ? 'active' : 'locked';
                const status = lessonStatusByNumber[lessonNumber] || defaultStatus;
                const exists = lessonExists(lessonNumber);
                // Урок неактивен, если он не существует или статус locked/нет статуса
                const isInactive = !exists || !(status === 'active' || status === 'completed');
                const isHovered = hoveredLesson === lessonNumber;
                // Яркость несуществующих уроков такая же, как неактивных
                const opacity = exists ? (isInactive ? 0.3 : 1) : 0.3;

                return (
                  <div
                    key={lessonNumber}
                    className="lesson-pentagon-wrapper"
                    style={{
                      left: position.left,
                      top: position.top,
                      cursor: exists ? (isInactive ? 'not-allowed' : 'pointer') : 'default',
                      opacity: opacity,
                    }}
                    onMouseEnter={() => exists && setHoveredLesson(lessonNumber)}
                    onMouseLeave={() => setHoveredLesson(null)}
                    onClick={() => exists && handleLessonClick(lessonNumber)}
                    role={exists ? "button" : undefined}
                    tabIndex={exists ? 0 : -1}
                    onKeyDown={(e) => { if (exists && (e.key === 'Enter' || e.key === ' ')) { e.preventDefault(); handleLessonClick(lessonNumber); } }}
                  >
                    <svg 
                      className="lesson-pentagon"
                      width="250" 
                      height="250" 
                      viewBox="-10 -150 227 247" 
                      fill="none" 
                      xmlns="http://www.w3.org/2000/svg"
                      preserveAspectRatio="xMidYMid meet"
                    >
                      <path 
                        d="M93.2529 -140.34C102.535 -145.699 113.971 -145.699 123.253 -140.34L201.506 -95.1603C210.788 -89.8013 216.506 -79.8975 216.506 -69.1795V21.1795C216.506 31.8975 210.788 41.8013 201.506 47.1602L123.253 92.3397C113.971 97.6987 102.535 97.6987 93.2529 92.3398L14.9998 47.1603C5.71773 41.8013 -0.000244141 31.8975 -0.000244141 21.1795V-69.1795C-0.000244141 -79.8975 5.71772 -89.8013 14.9998 -95.1603L93.2529 -140.34Z" 
                        fill={color}
                        fillOpacity={isInactive ? 0.3 : 1}
                      />
                    </svg>
                    <span className="lesson-number">{lessonNumber}</span>
                    {isHovered && (
                      <div className="lesson-tooltip">
                        <div className="lesson-tooltip-content">
                          {getLessonTitle(lessonNumber)}
                        </div>
                        <div className="lesson-tooltip-arrow"></div>
                      </div>
                    )}
                  </div>
                );
              })}
            </div>
          </div>
        </div>

        {/* Футер */}
        <div className="topic-articles-footer">
          <div className="topic-articles-footer-content">
            <div className="footer-logo">ЛОГОТИП</div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default TopicArticles;

